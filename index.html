<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å’–å•¡å°å°ç¢°éŠæˆ² - Coffee Expo 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #ffdb6a, #fff7de);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8B4513;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .container {
            max-width: 400px;
            width: 100%;
            padding: 20px;
            text-align: center;
        }

        /* é–‹å§‹ç•«é¢ */
        .start-screen {
            display: block;
        }

        .game-screen,
        .result-screen {
            display: none;
        }

        .start-screen h1 {
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            line-height: 1.3;
            color: #ff751f;
        }

        .start-screen p {
            font-size: 1.2rem;
            margin-bottom: 15px;
            opacity: 0.9;
            color: #794300;
        }

        .start-screen .game-instruction {
            font-size: 1rem;
            margin-bottom: 30px;
            color: #000000;
            line-height: 1.4;
            text-align: center;
        }

        .start-btn {
            background: #FF8C00;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .start-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        /* éŠæˆ²ç•«é¢ */
        .game-title {
            text-align: center;
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: #8B4513;
            font-weight: bold;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .card {
            aspect-ratio: 1;
            background: white;
            border-radius: 10px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            transition: transform 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            border: 2px solid #654321;
        }

        .card.flipped {
            background: white;
            color: #8B4513;
        }

        .card.matched {
            background: #90EE90;
            color: #228B22;
            cursor: default;
            animation: matchPulse 0.6s ease;
        }

        @keyframes matchPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        .card .card-back {
            width: 80%;
            height: 80%;
            margin: 10%;
        }

        /* é…å°æˆåŠŸå‹•ç•« */
        .success-animation {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.5rem;
            font-weight: bold;
            z-index: 1000;
            animation: successFade 2s ease-out forwards;
        }

        @keyframes successFade {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            80% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
        }

        /* çµæœç•«é¢ */
        .result-screen h2 {
            font-size: 2rem;
            margin-bottom: 20px;
        }

        .score-display {
            font-size: 3rem;
            margin: 20px 0;
            font-weight: bold;
        }

        .result-message {
            font-size: 1.2rem;
            margin-bottom: 30px;
        }

        .prize-image {
            width: 70%;
            max-width: 300px;
            height: auto;
            border-radius: 10px;
            margin-top: 10px;
        }

        .thank-you-image {
            width: 80%;
            max-width: 250px;
            height: auto;
            margin-bottom: 10px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        
        .thank-you-subtitle {
            margin-bottom: 20px;
            font-size: 1.1rem;
            color: #555;
        }
        
        .thank-you-maintext {
            line-height: 1.5;
            font-size: 1rem;
        }
        
        .thank-you-reminder {
            font-size: 0.8rem;
            color: #777;
        }
        
        .discount-details {
            margin-top: 20px;
            font-size: 0.85rem;
            display: inline-block;
            text-align: left;
            color: #444;
        }
        
        .discount-code {
            display: block;
            margin-top: 20px;
            font-size: 1.4rem;
            color: #000;
            font-weight: bold;
        }

        .restart-btn {
            background: #FF8C00;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.2rem;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            transform: scale(1.05);
        }

        .official-website-btn {
            background: #FF8C00;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.2rem;
            border-radius: 20px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            margin: 20px auto 0;
            display: block;
        }

        .official-website-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        /* è¨ˆæ™‚å™¨æ¨£å¼ */
        .timer {
            color: #FFD700;
            display: none;
        }

        .timer.warning {
            color: #FF4500;
            animation: timerWarning 0.5s infinite alternate;
        }

        @keyframes timerWarning {
            from { opacity: 1; }
            to { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é–‹å§‹ç•«é¢ -->
        <div class="start-screen">
            <h1>å¡å¡”æ‘©ç´å°å°ç¢°<br>ç¢°å‡ºå¥½æ‰‹æ°£</h1>
            <p style="margin-top: 50px;">å¹¸é‹åŠ æˆï¼Œé¦™æ°£éš¨è¡Œï½</p>
            <p class="game-instruction" style="margin-top: 50px;">é»æ“Šã€é–‹å§‹éŠæˆ²ã€‘ï¼Œ<br>åœ¨é™æ™‚å…§ç¿»å‡ºæˆå°çš„æ¿¾æ›å’–å•¡å¡ç‰‡ï¼Œ<br>å°±èƒ½æ‹¿çå“ï¼ğŸŒŸ</p>
            <button style="margin-top: 20px;" class="start-btn" onclick="startGame()">é–‹å§‹éŠæˆ²</button>
        </div>

        <!-- éŠæˆ²ç•«é¢ -->
        <div class="game-screen">
            <h2 class="game-title">ç¢°å‡ºå¥½æ‰‹æ°£</h2>
            <div class="game-info">
                <div class="timer">æ™‚é–“: <span id="time">5</span>ç§’</div>
            </div>
            <div class="game-board" id="game-board"></div>
        </div>

        <!-- çµæœç•«é¢ -->
        <div class="result-screen">
            <img id="thank-you-image" class="thank-you-image" style="display: none;" alt="éŠ˜è¬æƒ é¡§">
            <h2>éŠæˆ²çµæŸï¼</h2>
            <div class="score-display">åˆ†æ•¸: <span id="final-score">0</span></div>
            <div class="result-message" id="result-message"></div>
            <button class="official-website-btn" onclick="openOfficialWebsite()" style="display: none;">å‰å¾€å®˜ç¶²</button>
        </div>
    </div>

    <script>
        let gameData = {};
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let score = 0;
        let timeLeft = 5;
        let timerInterval;
        let isGamePaused = false;

        // è¨­ç½®èƒŒæ™¯
        function setBackground(backgroundKey) {
            if (gameData[backgroundKey] && gameData[backgroundKey].pic) {
                document.body.style.backgroundImage = `url('${gameData[backgroundKey].pic}')`;
            }
        }

        // è¼‰å…¥éŠæˆ²è³‡æ–™
        async function loadGameData() {
            try {
                const response = await fetch('./answer.json');
                gameData = await response.json();
                console.log('éŠæˆ²è³‡æ–™è¼‰å…¥æˆåŠŸ:', gameData);
            } catch (error) {
                console.error('è¼‰å…¥éŠæˆ²è³‡æ–™å¤±æ•—:', error);
            }
        }

        // é è¼‰å…¥åœ–ç‰‡
        function preloadImages(imageUrls) {
            return Promise.all(imageUrls.map(url => {
                return new Promise((resolve, reject) => {
                    const img = new Image();
                    img.onload = () => resolve(url);
                    img.onerror = () => reject(url);
                    img.src = url;
                });
            }));
        }

        // åˆå§‹åŒ–éŠæˆ²è³‡æ–™
        async function initGame() {
            await loadGameData();
            setBackground('èƒŒæ™¯-é–‹å§‹ç•«é¢');
        }

        // å‰µå»ºå¡ç‰Œ
        function createCards() {
            cards = [];
            const regions = Object.keys(gameData).filter(region => region !== 'JOKER' && region !== 'éŠ˜è¬æƒ é¡§' && !region.startsWith('èƒŒæ™¯')); // æ’é™¤JOKERã€éŠ˜è¬æƒ é¡§å’ŒèƒŒæ™¯
            const totalPairs = 8; // 8çµ„é…å° = 16å¼µæ­£å¸¸å¡ç‰Œ

            // éš¨æ©Ÿåˆ†é…çµ„åˆ
            for (let i = 0; i < totalPairs; i++) {
                const randomRegion = regions[Math.floor(Math.random() * regions.length)];
                cards.push({
                    id: i * 2,
                    region: randomRegion,
                    image: gameData[randomRegion].pic,
                    isFlipped: false,
                    isMatched: false,
                    isJoker: false
                });
                cards.push({
                    id: i * 2 + 1,
                    region: randomRegion,
                    image: gameData[randomRegion].pic,
                    isFlipped: false,
                    isMatched: false,
                    isJoker: false
                });
            }

            // æ·»åŠ 4å¼µJOKERå¡ç‰‡ï¼Œæ¯å¼µä½¿ç”¨ä¸åŒçš„JOKERåœ–ç‰‡
            const jokerImages = [...gameData['JOKER'].pic]; // è¤‡è£½åœ–ç‰‡åˆ—è¡¨
            for (let i = 0; i < 4; i++) {
                // éš¨æ©Ÿé¸æ“‡ä¸€å¼µJOKERåœ–ç‰‡
                const randomIndex = Math.floor(Math.random() * jokerImages.length);
                const selectedImage = jokerImages.splice(randomIndex, 1)[0]; // ç§»é™¤å·²é¸ä¸­çš„åœ–ç‰‡ï¼Œé¿å…é‡è¤‡

                cards.push({
                    id: totalPairs * 2 + i,
                    region: 'JOKER',
                    image: selectedImage,
                    isFlipped: false,
                    isMatched: false,
                    isJoker: true
                });
            }
        }

        // æ´—ç‰Œ
        function shuffleCards() {
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }
        }

        // æ¸²æŸ“å¡ç‰Œ
        function renderCards() {
            const gameBoard = document.getElementById('game-board');
            gameBoard.innerHTML = '';

            cards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = 'card';
                cardElement.dataset.index = index;

                if (card.isMatched) {
                    cardElement.classList.add('matched');
                }

                if (card.isFlipped || card.isMatched) {
                    cardElement.classList.add('flipped');
                    cardElement.innerHTML = `<img src="${card.image}" alt="${card.region}" class="card-front">`;
                } else {
                    cardElement.innerHTML = `<img src="./pic/back.png" alt="å¡ç‰‡èƒŒé¢" class="card-back">`;
                }

                cardElement.addEventListener('click', () => handleCardClick(index));
                gameBoard.appendChild(cardElement);
            });
        }

        // è™•ç†å¡ç‰Œé»æ“Š
        function handleCardClick(index) {
            if (isGamePaused) return;

            const card = cards[index];

            // é˜²æ­¢é»æ“Šå·²ç¿»é–‹æˆ–å·²åŒ¹é…çš„å¡ç‰Œ
            if (card.isFlipped || card.isMatched) return;

            // é˜²æ­¢åŒæ™‚ç¿»é–‹è¶…é2å¼µå¡ç‰Œ
            if (flippedCards.length >= 2) return;

            card.isFlipped = true;
            flippedCards.push(card);
            renderCards();

            // æª¢æŸ¥æ‰€æœ‰å·²ç¿»é–‹çš„ç‰Œä¸­æ˜¯å¦æœ‰ Joker
            const hasJoker = flippedCards.some(card => card.isJoker);

            if (hasJoker) {
                // å¦‚æœæœ‰ Jokerï¼Œç«‹å³è™•ç†ï¼ˆç„¡è«–æ˜¯ç¬¬ä¸€å¼µé‚„æ˜¯ç¬¬äºŒå¼µï¼‰
                isGamePaused = true; // é˜²æ­¢åœ¨è“‹èµ·æœŸé–“ç¿»å…¶ä»–å¡ç‰‡
                setTimeout(() => {
                    flippedCards.forEach(card => card.isFlipped = false);
                    flippedCards = [];
                    renderCards();
                    isGamePaused = false; // æ¢å¾©éŠæˆ²
                }, 500);
                return;
            }

            if (flippedCards.length === 2) {
                setTimeout(checkMatch, 500);
            }
        }

        // æª¢æŸ¥æ˜¯å¦åŒ¹é…
        function checkMatch() {
            const [card1, card2] = flippedCards;

            // å¦‚æœä»»ä¸€å¼µå¡ç‰‡æ˜¯JOKERï¼Œé…å°ä¸æˆåŠŸ
            if (card1.isJoker || card2.isJoker) {
                // åŒ¹é…å¤±æ•— - å…©å¼µä¸€èµ·è“‹èµ·
                isGamePaused = true; // é˜²æ­¢åœ¨è“‹èµ·æœŸé–“ç¿»å…¶ä»–å¡ç‰‡
                setTimeout(() => {
                    card1.isFlipped = false;
                    card2.isFlipped = false;
                    flippedCards = [];
                    renderCards();
                    isGamePaused = false; // æ¢å¾©éŠæˆ²
                }, 500);
                return; // æå‰è¿”å›ï¼Œä¸åŸ·è¡Œå¾Œé¢çš„é‚è¼¯
            } else if (card1.region === card2.region) {
                // åŒ¹é…æˆåŠŸ - ç«‹å³çµæŸéŠæˆ²
                card1.isMatched = true;
                card2.isMatched = true;
                matchedPairs++;

                // é¡¯ç¤ºæˆåŠŸå‹•ç•«ä¸¦çµæŸéŠæˆ²
                showSuccessAnimation(card1.region);
                setTimeout(() => {
                    endGame(card1.region);
                }, 2000);
            } else {
                // åŒ¹é…å¤±æ•— - å…©å¼µä¸€èµ·è“‹èµ·
                isGamePaused = true; // é˜²æ­¢åœ¨è“‹èµ·æœŸé–“ç¿»å…¶ä»–å¡ç‰‡
                setTimeout(() => {
                    card1.isFlipped = false;
                    card2.isFlipped = false;
                    flippedCards = [];
                    renderCards();
                    isGamePaused = false; // æ¢å¾©éŠæˆ²
                }, 500);
                return; // æå‰è¿”å›ï¼Œä¸åŸ·è¡Œå¾Œé¢çš„é‚è¼¯
            }
        }

        // é¡¯ç¤ºæˆåŠŸå‹•ç•«
        function showSuccessAnimation(region) {
            isGamePaused = true;

            const animation = document.createElement('div');
            animation.style.textAlign = 'center';
            animation.className = 'success-animation';
            animation.innerHTML = `${region}<br>é…å°æˆåŠŸï¼`;
            document.body.appendChild(animation);

            setTimeout(() => {
                document.body.removeChild(animation);
                isGamePaused = false;
            }, 2000);
        }

        // æ›´æ–°åˆ†æ•¸
        function updateScore() {
            document.getElementById('score').textContent = score;
        }

        // é–‹å§‹éŠæˆ²
        async function startGame() {
            // é¡¯ç¤ºè¼‰å…¥æç¤º
            const startBtn = document.querySelector('.start-btn');
            startBtn.disabled = true;
            startBtn.textContent = 'è¼‰å…¥ä¸­...';

            // å…ˆè¼‰å…¥éŠæˆ²è³‡æ–™
            await loadGameData();

            // æ”¶é›†æ‰€æœ‰éœ€è¦çš„åœ–ç‰‡URL
            const imageUrls = [
                './pic/back.png', // å¡ç‰‡èƒŒé¢
                ...Object.keys(gameData)
                    .filter(region => region !== 'JOKER' && !region.startsWith('èƒŒæ™¯')) // æ’é™¤JOKERå’ŒèƒŒæ™¯
                    .map(region => gameData[region].pic), // æ‰€æœ‰å’–å•¡ç”¢åœ°åœ–ç‰‡
                ...gameData['JOKER'].pic, // æ‰€æœ‰JOKERåœ–ç‰‡
                gameData['èƒŒæ™¯'].pic, // éŠæˆ²èƒŒæ™¯
                gameData['èƒŒæ™¯-ä¸­ç'].pic, // ä¸­çèƒŒæ™¯
                gameData['èƒŒæ™¯-é–‹å§‹ç•«é¢'].pic, // é–‹å§‹ç•«é¢èƒŒæ™¯
                gameData['éŠ˜è¬æƒ é¡§'].pic // éŠ˜è¬æƒ é¡§åœ–ç‰‡
            ];

            try {
                // é è¼‰å…¥æ‰€æœ‰åœ–ç‰‡
                await preloadImages(imageUrls);
                console.log('æ‰€æœ‰åœ–ç‰‡è¼‰å…¥å®Œæˆ');
            } catch (error) {
                console.error('åœ–ç‰‡è¼‰å…¥å¤±æ•—:', error);
                // å³ä½¿è¼‰å…¥å¤±æ•—ä¹Ÿè¦ç¹¼çºŒéŠæˆ²
            }

            // éš±è—é–‹å§‹ç•«é¢ï¼Œé¡¯ç¤ºéŠæˆ²ç•«é¢
            document.querySelector('.start-screen').style.display = 'none';
            document.querySelector('.game-screen').style.display = 'block';

            // è¨­ç½®éŠæˆ²èƒŒæ™¯
            setBackground('èƒŒæ™¯');

            // åˆå§‹åŒ–éŠæˆ²
            createCards();
            shuffleCards();
            renderCards();

            // é–‹å§‹è¨ˆæ™‚å™¨
            startTimer();
        }

        // é–‹å§‹è¨ˆæ™‚å™¨
        function startTimer() {
            const timerElement = document.getElementById('time');

            timerInterval = setInterval(() => {
                if (!isGamePaused) {
                    timeLeft--;
                    timerElement.textContent = timeLeft;

                    if (timeLeft <= 3) {
                        timerElement.parentElement.classList.add('warning');
                    }

                    if (timeLeft <= 0) {
                        endGame();
                    }
                }
            }, 1000);
        }

        // çµæŸéŠæˆ²
        function endGame(wonRegion = null) {
            clearInterval(timerInterval);

            // è¨­ç½®çµæœèƒŒæ™¯
            if (wonRegion) {
                setBackground('èƒŒæ™¯-ä¸­ç');
            } else {
                setBackground('èƒŒæ™¯');
            }

            document.querySelector('.game-screen').style.display = 'none';
            document.querySelector('.result-screen').style.display = 'block';

            const resultTitle = document.querySelector('.result-screen h2');
            const scoreDisplay = document.querySelector('.score-display');
            const resultMessage = document.getElementById('result-message');
            const thankYouImage = document.getElementById('thank-you-image');

            const officialWebsiteBtn = document.querySelector('.official-website-btn');

            if (wonRegion) {
                thankYouImage.style.display = 'none';
                resultTitle.style.display = 'block';
                // ç²å¾—çé …
                resultTitle.textContent = 'ğŸ‰ æ­å–œä¸­çï¼';
                scoreDisplay.style.display = 'none';
                const prizeImage = gameData[wonRegion] ? gameData[wonRegion].pic : '';
                resultMessage.innerHTML = `
                    æ­å–œç²å¾—<strong>${wonRegion}</strong>æ¿¾æ›å’–å•¡ 1 åŒ…<br>
                    è«‹å‡ºç¤ºæ­¤ç•«é¢å‘å·¥ä½œäººå“¡å…Œç<br>
                    <img src="${prizeImage}" alt="${wonRegion}å’–å•¡" class="prize-image">
                `;
                resultMessage.style.fontSize = '1.5rem';
                resultMessage.style.fontWeight = 'bold';
                resultMessage.style.color = '#A0522D';
                officialWebsiteBtn.style.display = 'none';
            } else {
                // æ™‚é–“çµæŸï¼Œæœªä¸­ç
                resultTitle.style.display = 'none';
                if (gameData['éŠ˜è¬æƒ é¡§'] && gameData['éŠ˜è¬æƒ é¡§'].pic) {
                    thankYouImage.src = gameData['éŠ˜è¬æƒ é¡§'].pic;
                    thankYouImage.style.display = 'block';
                }
                scoreDisplay.style.display = 'none';
                resultMessage.innerHTML = `
                    <p class="thank-you-subtitle">å·®ä¸€é»å°±ä¸­çå•¦~</p>
                    <p class="thank-you-maintext">åˆ¥é›£éï¼<br>
                    å‰å¾€å®˜ç¶²è¨»å†Šï¼ç™»å…¥æœƒå“¡ï¼Œ<br>
                    çµå¸³æ™‚è¼¸å…¥æŠ˜æ‰£ç¢¼<br>
                    <span class="thank-you-reminder">ï¼ˆè¨˜å¾—å…ˆè¤‡è£½æˆ–æˆªåœ–æ­¤ç•«é¢ï¼Œä»¥å…å¿˜è¨˜å–”ï¼ï¼‰</span><br>
                    å³å¯äº«æœ‰ $25 æŠ˜æ‰£âœ¨</p>
                    <div class="discount-details">
                        <p>ä½¿ç”¨æ¢ä»¶ï½œ æ¶ˆè²»æ»¿ $500 æŠ˜ $25</p>
                        <p>ä½¿ç”¨æœŸé™ï½œ å³æ—¥èµ·è‡³ 2025/12/31</p>
                    </div>
                    <strong class="discount-code">æŠ˜æ‰£ç¢¼ï¼šCOFFEE2025</strong>
                `;
                resultMessage.style.fontSize = '1rem';
                resultMessage.style.lineHeight = '1.6';
                officialWebsiteBtn.style.display = 'block';
            }
        }


        // å‰å¾€å®˜ç¶²
        function openOfficialWebsite() {
            window.open('https://www.catamona1998.com/', '_blank');
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.onload = initGame;
    </script>
</body>
</html>
